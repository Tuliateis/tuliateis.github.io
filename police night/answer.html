<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最终推理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: #000;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        /* 相机曝光效果 */
        .flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            z-index: 1000;
            pointer-events: none;
        }
        
        .flash-overlay.active {
            animation: flash 1.5s ease-out;
        }
        
        @keyframes flash {
            0% { opacity: 0; }
            20% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        /* 主容器 */
        .container {
            background: #6d1010; /* 深红色 */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        /* 背景水印 */
        .watermark {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Ctext x='50' y='100' font-family='Microsoft YaHei' font-size='30' fill='rgba(255,255,255,0.1)' transform='rotate(-30)'%3E警局夜班执勤事件%3C/text%3E%3C/svg%3E");
            background-repeat: repeat;
            opacity: 0.3;
            pointer-events: none;
        }
        
        /* 问题卡片 */
        .question-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            color: white;
            z-index: 2;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .question-title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            color: #fff;
            font-weight: 500;
        }
        
        /* 问题行 - 确保对齐 */
        .question-line {
            margin-bottom: 25px;
            font-size: 20px;
            line-height: 1.6;
            display: flex;
            align-items: baseline; /* 修改为baseline确保文字基线对齐 */
            flex-wrap: nowrap;
            min-height: 40px;
        }
        
        /* 文本部分 */
        .question-text {
            display: inline;
            white-space: nowrap;
        }
        
        /* 可点击的空白处 - 横线样式 */
        .blank-space {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 100px;
            height: 28px;
            margin: 0 6px;
            cursor: pointer;
            position: relative;
            font-size: 16px;
            text-align: center;
            vertical-align: baseline;
            color: #ffd700; /* 金色文字 */
            font-weight: 500;
        }
        
        /* 横线下划线 */
        .blank-space::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.6);
            transition: all 0.3s;
        }
        
        .blank-space:hover::after {
            background: rgba(255, 215, 0, 0.8);
        }
        
        .blank-space.selected {
            color: #ffd700;
        }
        
        .blank-space.selected::after {
            background: #ffd700;
        }
        
        /* 下拉菜单 */
        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            min-width: 120px;
            z-index: 100;
            display: none;
            font-size: 14px;
        }
        
        .dropdown.visible {
            display: block;
        }
        
        .dropdown-item {
            padding: 6px 10px;
            cursor: pointer;
            color: white;
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* 提交按钮容器 */
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        
        /* 提交按钮 */
        .submit-btn {
            width: 200px;
            padding: 12px 0;
            background: #4a6fd8;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .submit-btn:hover {
            background: #3a5ec8;
        }
        
        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        /* 记忆按钮 */
        .memory-btn {
            width: 250px;
            padding: 12px 0;
            background: #060705;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .memory-btn:hover {
            background: #81848a;
        }
        
        /* 错误提示 */
        .error-message {
            text-align: center;
            color: #ff6b6b;
            margin-top: 10px;
            min-height: 20px;
        }
        
        /* 隐藏类 */
        .hidden {
            display: none;
        }
        
        /* 显示类 */
        .visible {
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- 相机曝光层 -->
    <div class="flash-overlay" id="flashOverlay"></div>
    
    <div class="container">
        <!-- 背景水印 -->
        <div class="watermark"></div>
        
        <!-- 问题卡片 -->
        <div class="question-card" id="questionCard">
            <h1 class="question-title">最终推理</h1>
            
            <!-- 问题1 - 摩托车司机 -->
            <div class="question-line">
                <span class="question-text">你认为摩托车司机的身份是</span>
                <span class="blank-space" data-type="identity1" data-index="0" onclick="showDropdown(this)"></span>
                <span class="question-text">他是</span>
                <span class="blank-space" data-type="case1" data-index="1" onclick="showDropdown(this)"></span>
                <span class="question-text">的</span>
                <span class="blank-space" data-type="role1" data-index="2" onclick="showDropdown(this)"></span>
            </div>
            
            <!-- 问题2 - 轿车司机 -->
            <div class="question-line">
                <span class="question-text">你认为轿车司机的身份是</span>
                <span class="blank-space" data-type="identity2" data-index="3" onclick="showDropdown(this)"></span>
                <span class="question-text">他是</span>
                <span class="blank-space" data-type="case2" data-index="4" onclick="showDropdown(this)"></span>
                <span class="question-text">的</span>
                <span class="blank-space" data-type="role2" data-index="5" onclick="showDropdown(this)"></span>
            </div>
            
            <!-- 按钮容器 -->
            <div class="button-container" id="buttonContainer">
                <!-- 提交按钮 -->
                <button class="submit-btn" id="submitBtn" onclick="submitAnswers()">提交推理</button>
                
                <!-- 记忆按钮（初始隐藏） -->
                <button class="memory-btn hidden" id="memoryBtn" onclick="showMemory()">点击查看李江的记忆</button>
            </div>
            
            <!-- 错误提示 -->
            <div class="error-message" id="errorMsg"></div>
        </div>
    </div>
    
    <!-- 下拉菜单模板 -->
    <div class="dropdown hidden" id="dropdownTemplate">
        <div class="dropdown-item" data-value="李江">李江</div>
        <div class="dropdown-item" data-value="李海">李海</div>
        <div class="dropdown-item" data-value="刘建国">刘建国</div>
        <div class="dropdown-item" data-value="赵永贵">赵永贵</div>
    </div>
    
    <!-- 案件下拉菜单 -->
    <div class="dropdown hidden" id="caseDropdownTemplate">
        <div class="dropdown-item" data-value="李江失踪案">李江失踪案</div>
        <div class="dropdown-item" data-value="加油站杀人案">加油站杀人案</div>
    </div>
    
    <!-- 角色下拉菜单 -->
    <div class="dropdown hidden" id="roleDropdownTemplate">
        <div class="dropdown-item" data-value="凶手">凶手</div>
        <div class="dropdown-item" data-value="目击者">目击者</div>
        <div class="dropdown-item" data-value="被害人">被害人</div>
    </div>

    <script>
        // 用户答案存储
        let userAnswers = ['', '', '', '', '', '']; // 6个空白
        let currentDropdown = null;
        
        // 页面加载时触发相机曝光效果
        window.addEventListener('load', function() {
            const flashOverlay = document.getElementById('flashOverlay');
            flashOverlay.classList.add('active');
            
            setTimeout(() => {
                flashOverlay.classList.remove('active');
            }, 1500);
        });
        
        // 显示下拉菜单
        function showDropdown(blankElement) {
            // 隐藏当前打开的下拉菜单
            if (currentDropdown) {
                currentDropdown.classList.remove('visible');
                if (currentDropdown.parentNode) {
                    currentDropdown.parentNode.removeChild(currentDropdown);
                }
            }
            
            // 获取空白位置类型和索引
            const type = blankElement.getAttribute('data-type');
            const index = parseInt(blankElement.getAttribute('data-index'));
            
            // 克隆相应的下拉菜单模板
            let templateId;
            if (type.startsWith('identity')) {
                templateId = 'dropdownTemplate';
            } else if (type.startsWith('case')) {
                templateId = 'caseDropdownTemplate';
            } else if (type.startsWith('role')) {
                templateId = 'roleDropdownTemplate';
            }
            
            const template = document.getElementById(templateId);
            const dropdown = template.cloneNode(true);
            dropdown.id = 'dropdown-' + index;
            dropdown.classList.remove('hidden');
            
            // 设置下拉菜单位置
            const rect = blankElement.getBoundingClientRect();
            dropdown.style.position = 'fixed';
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            dropdown.style.zIndex = '1000';
            
            // 添加点击事件
            const items = dropdown.querySelectorAll('.dropdown-item');
            items.forEach(item => {
                item.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    blankElement.textContent = value;
                    blankElement.classList.add('selected');
                    
                    // 保存答案
                    userAnswers[index] = value;
                    
                    // 隐藏并移除下拉菜单
                    dropdown.classList.remove('visible');
                    setTimeout(() => {
                        if (dropdown.parentNode) {
                            dropdown.parentNode.removeChild(dropdown);
                        }
                    }, 100);
                    currentDropdown = null;
                    
                    // 检查是否所有选项都已填写
                    checkAllAnswers();
                });
            });
            
            // 显示下拉菜单
            document.body.appendChild(dropdown);
            setTimeout(() => {
                dropdown.classList.add('visible');
            }, 10);
            
            currentDropdown = dropdown;
            
            // 点击其他地方关闭下拉菜单
            document.addEventListener('click', function closeDropdown(e) {
                if (!blankElement.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('visible');
                    setTimeout(() => {
                        if (dropdown.parentNode) {
                            dropdown.parentNode.removeChild(dropdown);
                        }
                    }, 100);
                    document.removeEventListener('click', closeDropdown);
                    currentDropdown = null;
                }
            });
        }
        
        // 检查是否所有答案都已填写
        function checkAllAnswers() {
            const allFilled = userAnswers.every(answer => answer !== '');
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = !allFilled;
            
            return allFilled;
        }
        
        // 提交答案
        function submitAnswers() {
            const errorMsg = document.getElementById('errorMsg');
            
            // 检查是否所有选项都已填写
            if (!checkAllAnswers()) {
                errorMsg.textContent = '您还未做出选择';
                return;
            }
            
            // 触发第二次相机曝光效果
            const flashOverlay = document.getElementById('flashOverlay');
            flashOverlay.classList.add('active');
            
            setTimeout(() => {
                flashOverlay.classList.remove('active');
                
                // 隐藏提交按钮，显示记忆按钮
                const submitBtn = document.getElementById('submitBtn');
                const memoryBtn = document.getElementById('memoryBtn');
                
                submitBtn.classList.add('hidden');
                errorMsg.textContent = '';
                
                memoryBtn.textContent = '点击查看???的记忆';
                
                
                memoryBtn.classList.remove('hidden');
                
            }, 1500);
        }
        
        // 查看记忆
        function showMemory() {
            // 记录用户的选择
            console.log('用户推理结果:', {
                摩托车司机: {
                    身份: userAnswers[0],
                    案件: userAnswers[1],
                    角色: userAnswers[2]
                },
                轿车司机: {
                    身份: userAnswers[3],
                    案件: userAnswers[4],
                    角色: userAnswers[5]
                }
            });
            
            // 跳转到memory.html
            window.location.href = 'memory.html';
        }
        
        // 页面点击其他地方关闭下拉菜单
        document.addEventListener('click', function(e) {
            if (currentDropdown && !currentDropdown.contains(e.target)) {
                const blanks = document.querySelectorAll('.blank-space');
                let isClickOnBlank = false;
                
                blanks.forEach(blank => {
                    if (blank.contains(e.target)) {
                        isClickOnBlank = true;
                    }
                });
                
                if (!isClickOnBlank) {
                    currentDropdown.classList.remove('visible');
                    setTimeout(() => {
                        if (currentDropdown.parentNode) {
                            currentDropdown.parentNode.removeChild(currentDropdown);
                        }
                    }, 100);
                    currentDropdown = null;
                }
            }
        });
    </script>
</body>
</html>